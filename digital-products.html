<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="project-services.css" />

    <title>Digital Products</title>
    <!-- favicon -->
    <link rel="icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="stylesheet" href="./hystmodal.min.css" />
    <script src="./hystmodal.min.js"></script>
  </head>
  <body>
    <!-- Navbar -->
    <section>
      <nav class="navbar fixed-top navbar-expand-md navbar-dark p-md-3">
        <div class="container-fluid">
          <!-- LOGO -->
          <a class="navbar-brand text-black text-bold" href="index.html"
            ><img class="logo" src="images/logo.png" alt="logo"
          /></a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon bg-success"></span>
          </button>

          <!-- Navbar Menu -->
          <div
            class="collapse navbar-collapse justify-content-end"
            id="navbarNav"
          >
            <ul class="navbar-nav">
              <li class="nav-item position-relative">
                <a class="nav-link px-1 text-black" href="index.html">HOME</a>
              </li>
              <li class="nav-item position-relative project-dropdown">
                <a class="nav-link px-1 text-black" href="project-services.html"
                  >PROJECTS</a
                >
                <!-- Project dropdown -->
                <div class="project-link projecttab">
                  <ul class="">
                    <li class="nav-item list-unstyled">
                      <a class="nav-link text-black p-0" href="project1.html"
                        ><span class="hover-underline-animation"
                          >Ginama Project</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a class="nav-link text-black p-0" href="project2.html"
                        ><span class="hover-underline-animation"
                          >Nunez Project</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a class="nav-link text-black p-0" href="project3.html"
                        ><span class="hover-underline-animation"
                          >Castro Project</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a class="nav-link text-black p-0" href="project4.html"
                        ><span class="hover-underline-animation"
                          >Coffeeshop Project</span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </li>

              <li class="nav-item px-1 position-relative project-dropdown">
                <a class="nav-link text-black" href="digital-products.html">
                  DIGITAL PRODUCTS</a
                >
                <!-- Products dropdown -->
                <div class="project-link digitab">
                  <ul class="">
                    <li class="nav-item list-unstyled">
                      <a
                        class="nav-link text-black p-0"
                        href="digital-products.html"
                        ><span class="hover-underline-animation"
                          >Digital Planners</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a
                        class="nav-link text-black p-0"
                        href="digital-products.html"
                        ><span class="hover-underline-animation"
                          >Illustrations</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a class="nav-link text-black p-0" href="commissions.html"
                        ><span class="hover-underline-animation"
                          >Commissions</span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </li>

              <li class="nav-item px-1 position-relative project-dropdown">
                <a
                  class="nav-link text-black"
                  href="./project-services.html?redirect=aboutMe"
                  >ABOUT</a
                >
                <!-- About dropdown -->
                <div class="project-link abouttab">
                  <ul class="">
                    <li class="nav-item list-unstyled">
                      <a
                        class="nav-link text-black p-0"
                        href="./project-services.html?redirect=aboutMe"
                        ><span class="hover-underline-animation">Who</span></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a
                        class="nav-link text-black p-0"
                        href="./project-services.html?redirect=services"
                        ><span class="hover-underline-animation"
                          >Services</span
                        ></a
                      >
                    </li>
                    <li class="nav-item list-unstyled">
                      <a
                        class="nav-link text-black p-0"
                        href="./project-services.html?redirect=contact"
                        ><span class="hover-underline-animation"
                          >Contact</span
                        ></a
                      >
                    </li>
                  </ul>
                </div>
              </li>
              <li class="nav-item position-relative project-dropdown">
                <a
                  class="btn text-uppercase"
                  id="userName"
                  href="user-profile.html"
                  >ACCOUNT</a
                >
                <!-- Account dropdown -->
                <div class="project-link">
                  <ul class="">
                    <li
                      class="nav-item list-unstyled navLogOut"
                      id="logoutHandler"
                    ></li>
                    <li class="nav-item list-unstyled removeLogin"></li>
                    <li class="nav-item list-unstyled removeRegister"></li>
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a
                  class="btn btncolor rounded-0"
                  type="button"
                  data-bs-toggle="offcanvas"
                  data-bs-target="#offcanvasRight"
                  aria-controls="offcanvasRight"
                  href="#"
                >
                  CART (<span class="total-items-in-cart"></span>)</a
                >
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </section>

    <!-- Banner -->
    <section>
      <div class="banner">
        <p>
          SUBSCRIBE TO MY NEWSLETTER TO GET EXCLUSIVE PROMO CODES AND DISCOUNTS!
        </p>
      </div>
    </section>

    <!-- Digital-products -->
    <section class="container-fluid">
      <div class="mb-5"></div>

      <div
        class="container products d-flex justify-content-center flex-wrap gap-3 mb-5"
      >
        <!-- Card product -->
      </div>
    </section>

    <!-- Add to cart -->
    <section>
      <div
        class="offcanvas offcanvas-end"
        tabindex="-1"
        id="offcanvasRight"
        aria-labelledby="offcanvasRightLabel"
      >
        <div class="offcanvas-header">
          <h3 class="offcanvas-title" id="offcanvasRightLabel">CART</h3>

          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <hr class="mt-0" />

        <div class="offcanvas-body">
          <div class="cart-items">
            <!-- render cart items here -->
          </div>
          <div class="cartEmpty text-center">
            <!-- render cartEmpty text here -->
          </div>
        </div>
        <hr />
        <div class="offcanvas-bottom subtotal">
          <!-- render subtotal here -->
        </div>
        <div class="offcanvas-bottom checkOut">
          <!-- render checkout button here -->
        </div>
      </div>
    </section>

    <!-- Commissions -->
    <section>
      <div class="container mt-5">
        <div>
          <p class="w-50 m-auto pt-5 pb-4 text-center">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Rem amet
            magnam, alias, labore nesciunt unde voluptate laborum deserunt
            aperiam explicabo, beatae sed! Deserunt deleniti esse fuga quisquam
            consequatur voluptates nostrum cupiditate asperiores nam ex, nulla
            voluptate magni mollitia dolore. Incidunt.
          </p>
        </div>

        <div class="text-center">
          <a class="btn btncolor rounded-0" href="commissions.html"
            >COMMISSIONS</a
          >
        </div>
      </div>
    </section>

    <!-- footer -->
    <section id="mainFooter">
      <div class="container-fluid p-4">
        <div class="row d-flex justify-content">
          <!-- contact details -->
          <div class="contacts col-lg-4 mb-4 mb-md-0">
            <p class="">CONTACT</p>
            <p class="m-0">1111 - 222 - 333</p>
            <p class="m-0">ar.mjoenaren@gmail.com</p>
            <p class="m-0">Brgy. Kausawagan</p>
            <p class="m-0">Cagayan de Oro City</p>
            <p>Misamis Oriental, 9000</p>

            <!-- social media -->
            <div id="socialLinks">
              <a
                class="nav-link pinterest"
                href="https://www.pinterest.ph/mariejoenarenm/"
              >
                <i class="bi bi-pinterest"></i>
              </a>

              <a
                class="nav-link instagram"
                href="https://www.instagram.com/ar.mjnm_designs/"
              >
                <i class="bi bi-instagram"></i>
              </a>

              <a
                class="nav-link linkedin"
                href="https://www.linkedin.com/in/marie- joenaren-m-833101151/"
              >
                <i class="bi bi-linkedin"></i>
              </a>

              <a class="nav-link whatsapp" href="#">
                <i class="bi bi-whatsapp"></i>
              </a>

              <a
                class="nav-link youtube"
                href="https://www.youtube.com/channel/UCYPWdxnxQh6GrL1i4rXDdkg"
              >
                <i class="bi bi-youtube"></i>
              </a>
            </div>

            <!-- index logo -->
            <div class="indexLogo">
              <img
                class="footerLogo"
                src="main_assets/mjm logo light.png"
                alt="mjm logo"
              />
            </div>
          </div>

          <!-- quick links -->
          <div class="qLinks col-lg-4 mb-4 mb-md-0">
            <p>LINKS</p>
            <ul class="list-unstyled">
              <li class="nav-item">
                <a class="nav-link" href="#"><p>about</p></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><p>works</p></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#"><p>services</p></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="shop.html"><p>digital products</p></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#!"><p>payments</p></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#!"><p>FAQs</p></a>
              </li>
            </ul>
          </div>

          <!-- newsletter -->
          <div class="col-lg-4 mb-4 mb-md-0">
            <form action="">
              <p>NEWSLETTER</p>

              <ul class="list-unstyled">
                <li>
                  <p class="m-0">Subscribe to receive updates, access to</p>
                  <p class="mt-0">promo codes, and more!</p>
                </li>

                <li class="mb-3">
                  <input
                    class="p-2 w-75 rounded-0"
                    type="email"
                    placeholder="enter your email"
                  />
                </li>
                <li>
                  <button type="submit" class="btn btncolor rounded-0 w-75">
                    SUBSCRIBE
                  </button>
                </li>
              </ul>
            </form>

            <!-- terms and policies -->
            <div class="termsAndPolicies">
              <ul class="list-unstyled">
                <li class="nav-item">
                  <a class="nav-link" href="#"> Terms and Conditions </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link policy" href="#"> Privacy Policies </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div id="modal_container">
      <!-- insert modal  -->
    </div>

    <script src="products.js"></script>

    <!-- JS -->
    <script>
      // navbar show when scroll up
      var prevScrollpos = window.pageYOffset;

      window.onscroll = function () {
        var currentScrollPos = window.pageYOffset;
        if (prevScrollpos > currentScrollPos) {
          document.querySelector("nav").style.top = "0";
        } else {
          document.querySelector("nav").style.top = "-7.2rem";
        }
        prevScrollpos = currentScrollPos;
      };

      // usernameDashboard
      const usernameDashboard = document.getElementById("userName");
      const logoutHandler = document.getElementById("logoutHandler");
      const userInfo = JSON.parse(localStorage.getItem("userInfo"));
      const navLogOut = document.querySelector(".navLogOut");
      const userData = userInfo?.find((user) => user.isLoggedIn === true);
      const removeLogin = document.querySelector(".removeLogin");
      const removeRegister = document.querySelector(".removeRegister");

      removeLogin.innerHTML = userData
        ? ``
        : `<a class="nav-link text-black p-0" href="Login-page.html"
                        ><span class="hover-underline-animation">Login</span></a
                      >`;
      removeRegister.innerHTML = userData
        ? ``
        : ` <a
                        class="nav-link text-black p-0"
                        href="register-page.html"
                        ><span class="hover-underline-animation"
                          >Register</span
                        ></a
                      >`;

      usernameDashboard.addEventListener("click", (e) => {
        e.preventDefault();
        // console.log(userData);

        if (userData) {
          location.href = "user-profile.html";
        }
      });

      usernameDashboard.innerHTML = userData
        ? `<i class="bi bi-person-circle"></i> ${userData?.firstName}`
        : "Account";
      navLogOut.innerHTML = userData
        ? `<a class="nav-link text-black p-0" href="Login-page.html"
                        ><span class="hover-underline-animation">Logout</span></a
                      >`
        : "";

      logoutHandler.addEventListener("click", (e) => {
        e.preventDefault();

        let newData = userInfo.map((data) => {
          if (data.isLoggedIn === true) {
            return { ...userData, isLoggedIn: false };
          } else {
            return data;
          }
        });

        localStorage.setItem("userInfo", JSON.stringify(newData));

        window.location.href = "digital-products.html";
      });

      // Add to cart

      // SELECT ELEMENTS
      const productsEl = document.querySelector(".products");
      const cartItemsEl = document.querySelector(".cart-items");
      const subtotalEl = document.querySelector(".subtotal");
      const totalItemsInCartEl = document.querySelector(".total-items-in-cart");
      const checkOut = document.querySelector(".checkOut");
      const cartEmpty = document.querySelector(".cartEmpty");
      let cart = JSON.parse(localStorage.getItem("cartItems")) || [];

      // RENDER PRODUCTS
      function renderProducts() {
        products.forEach((product) => {
          productsEl.innerHTML += `
                <div class="card rounded-0" style="width: 345px; height: 350px" >
                  <a href="" data-bs-toggle="modal" data-bs-target="#modal${
                    product.id
                  }">
                  <img style="width:343px;height: 200px" src="${
                    product.imgSrc
                  }" alt="${product.name}"> 
                </a>
        
                    <div>${product.name}</div>
                    <p>&#8369;${product.price}</p>
                    <div>${product.description}</div>
                    <div class="add-to-cart" onclick="addToCart(${product.id})">
                    ${
                      userData
                        ? `<button class ="btn btncolor rounded-0"  data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasRight"
                            aria-controls="offcanvasRight">Add to Cart</button>`
                        : `
                        <button class ="btn btncolor rounded-0">Add to Cart</button>
                        `
                    }
                    </div>
                 </div>

                    `;
        });
      }
      // Modal for product details
      const modalContainer = document.getElementById("modal_container");

      function renderModal() {
        let html_string = "";
        products.forEach((product) => {
          html_string += `
          <div
          class="modal fade"
          id="modal${product.id}"
          tabindex="-1"
          aria-labelledby="exampleModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">
                  ${product.name}
                </h1>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="modal_image">
                  <img src="${product.imgSrc}">
                </div>
                <p>
                  ${product.description}
              </p></div>
         
            </div>
          </div>
        </div>
          `;
        });
        modalContainer.innerHTML = html_string;
      }
      renderModal();
      // RENDER THE PRODUCTS IN USER INTERFACE
      renderProducts();

      function addToCart(id) {
        // check if prodcut already exist in cart
        if (userData) {
          const item = products.find((product) => product.id === id);

          const userEmail = userData.email;
          // console.log(item.id);
          // console.log(cart, "cart");
          //check if id is present

          //TODO: CHECK IF THE USER HAS CART WITH SAME PRODUCT ID

          const cartItemExist = cart.find(
            (product) =>
              product.id === item.id && product.email === userData.email
          );
          // console.log(item, "item Data");
          const userHasCart = cart.find(
            (product) => product.email === item.email
          );

          console.log(cartItemExist, "cartItemExist");
          if (cartItemExist && cartItemExist.email === userData.email) {
            console.log("hello");
            console.log(cart, "cart");
            // const result = changeNumberOfUnits("plus", item.id, userEmail);

            const result = cart.map((cartItem) => {
              //console.log(cartItem);
              return cartItem.id === item.id
                ? { ...cartItem, quantity: cartItem.quantity + 1 }
                : cartItem;
            });
            console.log(result, "result");
            console.log(cart, "cart");

            cart = [...result];
          } else {
            console.log("hi");

            cart = [...cart, { ...item, email: userEmail, quantity: 1 }];
          }
        } else {
          alert("You need to login first!, will be redirected to login page");
          location.href = "Login-page.html";
        }

        updateCart();
      }

      function addCartQuantity(id) {
        const item = products.find((product) => product.id === id);
        console.log(item);
        const result = cart.map((cartItem) => {
          return cartItem.id === item.id
            ? { ...cartItem, quantity: cartItem.quantity + 1 }
            : cartItem;
        });
        cart = [...result];
        updateCart();
      }

      function minusCartQuantity(id) {
        const item = products.find((product) => product.id === id);
        console.log(item);
        const result = cart.map((cartItem) => {
          return cartItem.id === item.id && cartItem.quantity > 1
            ? { ...cartItem, quantity: cartItem.quantity - 1 }
            : cartItem;
        });
        cart = [...result];
        updateCart();
      }

      // remove item from cart
      function removeItemFromCart(id) {
        cart = cart.filter((item) => item.id !== id);
        checkOut.innerHTML = ``;
        cartEmpty.innerHTML = `<p>YOUR CART IS EMPTY</p>`;

        updateCart();
      }
    </script>
    <script src="render.js"></script>
    <script src="sendEmail.js"></script>
  </body>
</html>
